"undefined"==typeof XWiki&&alert("ERROR: xwikiexplorer.js depends on xwiki.js");for(var name in isc.Page)if(isc.Page.hasOwnProperty(name)&&isc.Page[name]&&isc.Page[name].APP){isc.Page[name].APP="";break}isc.Page.setSkinDir("/wiki/resources/js/xwiki/wysiwyg/xwe/sc/skins/Enterprise/");var sc_style_link=document.createElement("link");sc_style_link.setAttribute("rel","stylesheet");sc_style_link.type="text/css";sc_style_link.href="/wiki/resources/js/xwiki/wysiwyg/xwe/sc/skins/Enterprise/skin_styles.css"; document.body.appendChild(sc_style_link);XWiki.constants.rest={baseRestURI:eXo.env.portal.context+"/"+eXo.env.rest.context+"/",restChildrenRel:"http://www.xwiki.org/rel/children",restParentRel:"http://www.xwiki.org/rel/parent",restAttachmentsRel:"http://www.xwiki.org/rel/attachments",restHomeRel:"http://www.xwiki.org/rel/home"};isc.ClassFactory.defineClass("XWEResultTree",isc.ResultTree); isc.XWEResultTree.addClassProperties({constants:{addNodeSuffix:"..new",attachmentsTitle:"Attachments",addPageTitle:"New page...",addAttachmentTitle:"Upload file..."}});isc.XWEResultTree.addProperties({multiDSTree:!0,callbacks:{dataArrived:[]},parentMap:{},displayLinks:!0,displayAddPage:!1,displayAddPageOnTop:!0,displayAttachments:!0,displayAttachmentsOnTop:!1,displayAttachmentsWhenEmpty:!1,displayAddAttachment:!1,displayAddAttachmentOnTop:!0,displayBlacklistedSpaces:!1}); isc.XWEResultTree.addMethods({getChildDataSource:function(a,b){var c=a[this.childTypeProperty];if(null!=c)return isc.DS.get(c);b=b||this.getNodeDataSource(a);if(null==b||!this.isMultiDSTree())return this.getRootDataSource();var d=this.treeRelations,e=b.getChildDataSources(),f=XWiki.resource.get(a.id);a.resource=f;"XWEDataSource"==b.Class?c=isc.XWEWikiDataSource.getOrCreate(f.wiki).getID():"XWEWikiDataSource"==b.Class?c=isc.XWESpaceDataSource.getOrCreate(f.wiki,f.space).getID():"XWESpaceDataSource"== b.Class?c=null==a.isXWikiAttachment?isc.XWESpaceDataSource.getOrCreate(f.wiki,f.space).getID():isc.XWEAttachmentsDataSource.getOrCreate(f.wiki,f.space,f.name).getID():d&&(c=d[b.ID]);if(null!=c)return isc.DS.get(c);if(null!=e)return e[0]},dataArrived:function(a){var b=this.getNodeDataSource(a),c="";null==b&&(b=this.getDataSource());"XWEWikiDataSource"==b.Class&&!1==this.displayBlacklistedSpaces&&this.filterNodesByName(this.getChildren(),XWiki.blacklistedSpaces);for(var d=this.getChildren(a),e=0;e< d.length;e++){var f=this.getNodeDataSource(d[e]),g=d[e].name;!0==this.displayLinks&&null!=d[e].xwikiRelativeUrl&&(g="<a href='"+d[e].xwikiRelativeUrl+"'>"+g+"</a>");isc.addProperties(d[e],{icon:f.icon,title:g,isNewPage:!1,isNewAttachment:!1});0==e&&(c=f.Class)}"XWESpaceDataSource"==c&&"XWEWikiDataSource"==b.Class&&!0==this.displayAddPage&&this.addAddPageNode(a);"XWESpaceDataSource"==b.Class&&!0==this.displayAttachments&&!a.isXWikiAttachment&&this.addAttachmentsNode(a);a.isXWikiAttachment&&!0==this.displayAddAttachment&& this.addAddAttachmentsNode(a);0<this.callbacks.dataArrived.length&&this.callbacks.dataArrived.shift().callback()},isFolder:function(a){var b=this.getNodeDataSource(a);if(null!=b&&"XWEDataSource"!=b.Class&&"XWEWikiDataSource"!=b.Class){if("XWESpaceDataSource"==b.Class){if(!0==a.isXWikiAttachment)return!0;a=null!=a.link?a.link:[];for(b=0;b<a.length;b++)if(a[b].rel==XWiki.constants.rest.restChildrenRel||a[b].rel==XWiki.constants.rest.restAttachmentsRel||this.displayAttachmentsWhenEmpty||this.displayAddAttachment)return!0; return!1}if("XWEAttachmentsDataSource"==b.Class)return!1}return!0},getChildNodeByName:function(a,b){var c=this.getChildren(a);if(null!=c)for(var d=0;d<c.length;d++)if(c[d].name==b)return c[d];return null},filterNodesByName:function(a){for(var b=0;b<a.length;b++)XWiki.blacklistedSpaces&&-1!=XWiki.blacklistedSpaces.indexOf(a[b].name)&&this.remove(a[b])},addAddPageNode:function(a){this.add({id:a.id+isc.XWEResultTree.constants.addNodeSuffix,wiki:a.wiki,space:a.space,title:isc.XWEResultTree.constants.addPageTitle, parentId:a.id,icon:"/wiki/skin/DefaultSkin/webui/UIWikiRichTextEditor/images/bullet_add.gif",resource:a.resource,isNewPage:!0,isNewAttachment:!1,clickCallback:function(a,c){c.resource=XWiki.resource.get(c.resource.prefixedSpace);a.input.value=""}},a,!0==this.displayAddPageOnTop?0:null)},addAddAttachmentsNode:function(a){this.add({id:a.id+isc.XWEResultTree.constants.addNodeSuffix,wiki:a.wiki,space:a.space,title:isc.XWEResultTree.constants.addAttachmentTitle,parentId:a.id,icon:"/wiki/skin/DefaultSkin/webui/UIWikiRichTextEditor/images/bullet_add.gif", resource:a.resource,isNewPage:!1,isNewAttachment:!0,clickCallback:function(a){a.input.value=""}},a,!0==this.displayAddAttachmentsOnTop?0:null)},addAttachmentsNode:function(a){var b=!1;this.getNodeDataSource(a);if(!0==this.displayAttachmentsWhenEmpty||this.displayAddAttachment)b=!0;else for(var c=null!=a.link?a.link:[],b=!1,d=0;d<c.length;d++)if(c[d].rel==XWiki.constants.rest.restAttachmentsRel){b=!0;break}!0==b&&(b=isc.XWEResultTree.constants.attachmentsTitle+" ("+a.name+")",!0==this.displayLinks&& (b="<a href='"+a.xwikiRelativeUrl+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor+"'>"+b+"</a>"),this.add({id:a.id+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor,fullName:a.fullName+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor,wiki:a.wiki,space:a.space,title:b,name:a.name,parentId:a.id,xwikiRelativeURL:a.xwikiRelativeURL+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor,icon:"/wiki/skin/DefaultSkin/webui/UIWikiRichTextEditor/images/page_white_zip.gif", resource:XWiki.resource.get(a.id+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor),isXWikiAttachment:!0,isNewPage:!1,isNewAttachment:!1},a,!0==this.displayAttachmentsOnTop?0:null))}});isc.ClassFactory.defineClass("XWEDataSource",isc.DataSource);isc.XWEDataSource.addClassProperties({sep:"_"}); isc.XWEDataSource.addProperties({dataFormat:"xml",xmlNamespaces:{xwiki:"http://www.xwiki.org"},resultTreeClass:"XWEResultTree",transformResponse:function(a,b,c){0<this.callbacks.transformResponse.length&&this.callbacks.transformResponse.shift().callback(a,b,c);return a},dataURL:XWiki.constants.rest.baseRestURI+"wiki/",recordXPath:"/xwiki:wikis/xwiki:wiki",fields:[{name:"id",required:!0,type:"text",primaryKey:!0},{name:"name",type:"text"},{name:"title",type:"text"},{name:"xwikiRelativeUrl",type:"text"}], icon:"/wiki/skin/DefaultSkin/webui/UIWikiRichTextEditor/images/database.gif",requestProperties:{promptStyle:"cursor"},callbacks:{transformResponse:[]}});isc.XWEDataSource.addMethods({transformRequest:function(a){a.originalData&&(a.originalData.r=""+Math.floor(1E6*Math.random()));return a.data}});isc.ClassFactory.defineClass("XWEWikiDataSource",isc.XWEDataSource); isc.XWEWikiDataSource.addClassMethods({getOrCreate:function(a){var b="XWEWikiDataSource_"+a,c=this.get(b);null==c&&(c=this.create({ID:b,wiki:a}));return c}});isc.XWEWikiDataSource.addProperties({wiki:XWiki.currentWiki,recordXPath:"/xwiki:spaces/xwiki:space",fields:[{name:"id",required:!0,type:"text",primaryKey:!0},{name:"name",required:!0,type:"text"},{name:"title",type:"text"},{name:"xwikiRelativeUrl",type:"text"}],icon:"/wiki/skin/DefaultSkin/webui/background/folder.gif"}); isc.XWEWikiDataSource.addMethods({init:function(){this.dataURL=XWiki.constants.rest.baseRestURI+"wiki/"+eXo.wiki.UIWikiRichTextArea.wiki+"/spaces";this.Super("init",arguments)}});isc.ClassFactory.defineClass("XWESpaceDataSource",isc.XWEDataSource);isc.XWESpaceDataSource.addClassMethods({getOrCreate:function(a,b){var c="XWESpaceDataSource_"+a+isc.XWEDataSource.sep+b,d=this.get(c);null==d&&(d=this.create({ID:c,wiki:a,space:b}));return d}}); isc.XWESpaceDataSource.addProperties({wiki:"xwiki",space:"Main",recordXPath:"/xwiki:pages/xwiki:pageSummary",fields:[{name:"id",required:!0,type:"text",primaryKey:!0},{name:"fullName",required:!0,type:"text"},{name:"wiki",required:!0,type:"text"},{name:"space",required:!0,type:"text"},{name:"name",required:!0,type:"text"},{name:"title",required:!0,type:"text"},{name:"parentId",required:!0,type:"text",foreignKey:"id"},{name:"parent",required:!0,type:"text"},{name:"xwikiRelativeUrl",type:"text"},{name:"link", propertiesOnly:!0}],icon:"/wiki/skin/DefaultSkin/webui/background/page_white_text.gif"}); isc.XWESpaceDataSource.addMethods({init:function(){this.dataURL=XWiki.constants.rest.baseRestURI+"wiki/"+eXo.wiki.UIWikiRichTextArea.wiki+"/spaces/"+this.space+"/pages";this.transformRequest=function(a){var b=eXo.wiki.UIWikiRichTextArea.wiki+XWiki.constants.wikiSpaceSeparator+this.space;if(a.originalData.parentId==b||null==a.originalData.parentId)a.originalData.parentId="^(?!"+b+".).*$";return this.Super("transformRequest",arguments)};this.Super("init",arguments)}}); isc.ClassFactory.defineClass("XWEPageDataSource",isc.XWEDataSource);isc.XWEPageDataSource.addClassMethods({getOrCreate:function(a,b,c){var d="XWEPageDataSource_"+a+isc.XWEDataSource.sep+b+isc.XWEDataSource.sep+c,e=this.get(d);null==e&&(e=this.create({ID:d,wiki:a,space:b,page:c}));return e}}); isc.XWEPageDataSource.addProperties({wiki:"xwiki",space:"Main",page:"WebHome",recordXPath:"/xwiki:page",fields:[{name:"id",required:!0,type:"text",primaryKey:!0},{name:"wiki",required:!0,type:"text"},{name:"space",required:!0,type:"text"},{name:"name",required:!0,type:"text"},{name:"parentId",required:!0,type:"text"},{name:"parent",required:!0,type:"text"},{name:"link",propertiesOnly:!0}],icon:"/wiki/skin/DefaultSkin/webui/background/page_white_text.gif"}); isc.XWEPageDataSource.addMethods({init:function(){this.dataURL=XWiki.constants.rest.baseRestURI+"wiki/"+eXo.wiki.UIWikiRichTextArea.wiki+"/spaces/"+this.space+"/pages/"+this.page;this.Super("init",arguments)}});isc.ClassFactory.defineClass("XWEAttachmentsDataSource",isc.XWEDataSource); isc.XWEAttachmentsDataSource.addClassMethods({getOrCreate:function(a,b,c){var d="XWEAttachmentsDataSource_"+a+isc.XWEDataSource.sep+b+isc.XWEDataSource.sep+c,e=this.get(d);null==e&&(e=this.create({ID:d,wiki:a,space:b,page:c}));return e}}); isc.XWEAttachmentsDataSource.addProperties({wiki:"xwiki",space:"Main",page:"WebHome",recordXPath:"/xwiki:attachments/xwiki:attachment",fields:[{name:"id",required:!0,type:"text",primaryKey:!0},{name:"name",required:!0,type:"text"},{name:"title",type:"text"},{name:"xwikiRelativeUrl",type:"text"}],icon:"/wiki/skin/DefaultSkin/webui/background/attach.gif"}); isc.XWEAttachmentsDataSource.addMethods({init:function(){this.dataURL=XWiki.constants.rest.baseRestURI+"wiki/"+eXo.wiki.UIWikiRichTextArea.wiki+"/spaces/"+this.space+"/pages/"+this.page+"/attachments";this.Super("init",arguments)}});isc.ClassFactory.defineClass("XWETreeGrid",isc.TreeGrid); isc.XWETreeGrid.addProperties({autoDraw:!1,autoFetchData:!0,nodeClick:function(a,b,c){this.nodeClickCallback(a,b,c)},showHeader:!1,folderIcon:"/wiki/skin/DefaultSkin/webui/background/database.gif",position:"relative",dropIconSuffix:"",openIconSuffix:"",closedIconSuffix:"",animateFolders:!1,wiki:eXo.wiki.UIWikiRichTextArea.wiki,space:null,displaySuggest:!0,defaultValue:"Main.WebHome",inputValueCache:""}); isc.XWETreeGrid.addMethods({draw:function(){if(null!=this.Super("draw",arguments))return this;"undefined"==typeof this.input&&null==this.input&&this.drawInput();for(member in this)"function"!=typeof member&&member.startsWith("display")&&(this.data[member]=this[member]);var a=document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.media="screen";b.styleSheet?b.styleSheet.cssText="div.listGrid td, div.listGrid table {margin:0;padding:0;} div.listGrid td {border:0;color:#333;} #actionmenu {z-index: 999999;}": b.appendChild(document.createTextNode("div.listGrid td, div.listGrid table {margin:0;padding:0;} div.listGrid td {border:0;color:#333;} #actionmenu {z-index: 999999;}"));a.appendChild(b)},invalidateCache:function(){this.Super("invalidateCache",arguments);this.inputValueCache=""},openNode:function(a,b,c){var d={treeId:this.getID(),callback:function(){window[this.treeId].openNodesFromInput()}},b=a.findById(b);if(null!=b){if(a.isFolder(b)&&!a.isOpen(b))return!0==c&&this.getData().callbacks.dataArrived.push(d), a.openFolder(b),null;this.selectNodeAndScroll(b);return b}return null},selectNodeAndScroll:function(a){this.deselectAllRecords();this.selectRecord(a);nodeYPos=this.getFocusRow()*this.getRowHeight();this.body.scrollTo(this.body.getScrollLeft(),nodeYPos)},openParent:function(a,b){if(""!=b.name)if(null==a.parentMap[b.prefixedFullName]){var c=isc.XWEPageDataSource.getOrCreate(b.wiki,b.space,b.name),d=function(c){200==c.httpResponseCode&&c.data[0]&&c.data[0].parent?(c=XWiki.resource.get(c.data[0].parent), a.findById(c.fullName),a.parentMap[b.prefixedFullName]=c,null!=a.findById(c.prefixedFullName)?this.openNode(a,c.prefixedFullName,!0):this.openParent(a,c)):!0==this.displayAddPage&&(c=this.getData().findById(b.prefixedSpace+isc.XWEResultTree.constants.addNodeSuffix),c.resource=b,this.selectNodeAndScroll(c))}.bind(this);c.fetchData(null,d,null)}else c=a.parentMap[b.prefixedFullName],null!=a.findById(c.prefixedFullName)?this.openNode(a,c.prefixedFullName,!0):this.openParent(a,c)},openNodesFromInput:function(){var a= this.getDataSource().Class,b=XWiki.resource.get(this.input.value),c=XWiki.resource.get(""),d=this.getData();if(!("XWEDataSource"==a&&null==this.openNode(d,b.wiki,!0))){if("XWEDataSource"==a||"XWEWikiDataSource"==a)if(b.space!=c.space&&this.deselectRecord(this.getSelectedRecord()),null==this.openNode(d,b.prefixedSpace,!0))return;null==this.openNode(d,b.prefixedFullName,!0)&&this.openParent(d,b);(c.attachment!=b.attachment||c.anchor!=b.anchor&&b.anchor==XWiki.constants.docextraAttachmentsAnchor)&&null!= this.openNode(d,b.prefixedFullName+XWiki.constants.anchorSeparator+XWiki.constants.docextraAttachmentsAnchor,!0)&&this.openNode(d,b.prefixedFullName+XWiki.constants.pageAttachmentSeparator+b.attachment,!1)}},inputObserver:function(){var a=this.input.value;""!=a&&a!=this.inputValueCache&&(this.openNodesFromInput(),this.inputValueCache=a);setTimeout(this.inputObserver.bind(this),2E3)},drawInput:function(){var a=!1==this.displaySuggest?"hidden":"text",b=this.width-6,c=document.createElement("input"); c.setAttribute("id",this.getID()+"_Input");c.setAttribute("name",this.getID()+"_Input");c.setAttribute("style","width:"+b+"px;clear:both");c.setAttribute("type",a);this.defaultValue&&c.setAttribute("value",this.defaultValue);this.htmlElement.appendChild(c);this.input=c;this.displaySuggest?(Event.observe(c,"focus",function(){(new ajaxSuggest(this,{script:"/xwiki/rest/wiki/"+XWiki.currentWiki+"/search?scope=name&",varname:"q"})).setSuggestions=function(a){this.aSuggestions=[];for(var a=a.responseXML.getElementsByTagName("searchResult"), b=0;b<a.length;b++){var c=a[b].getElementsByTagName("id")[0].firstChild.nodeValue,g=a[b].getElementsByTagName("space")[0].firstChild.nodeValue,h=a[b].getElementsByTagName("pageName")[0].firstChild.nodeValue;a[b].hasChildNodes()&&this.aSuggestions.push({id:c,value:g+XWiki.constants.spacePageSeparator+h,info:""})}this.idAs="as_"+this.fld.id;this.createList(this.aSuggestions)}}),a={treeId:this.getID(),callback:function(){window[this.treeId].inputObserver()}}):a={treeId:this.getID(),callback:function(){window[this.treeId].openNodesFromInput()}}; this.getData().callbacks.dataArrived.push(a)},nodeClickCallback:function(a,b,c){null==b.clickCallback?(a=b.id,!a.include(XWiki.constants.wikiSpaceSeparator)&&"XWEDataSource"==this.getData().getNodeDataSource(b).Class&&(a=a+XWiki.constants.wikiSpaceSeparator+"Main"+XWiki.constants.spacePageSeparator+"WebHome"),!a.include(XWiki.constants.spacePageSeparator)&&"XWEWikiDataSource"==this.getData().getNodeDataSource(b).Class&&(a=a+XWiki.constants.spacePageSeparator+"WebHome"),"XWEDataSource"!=this.getDataSource().Class&& (a=a.substring(a.indexOf(XWiki.constants.wikiSpaceSeparator)+1,a.length)),b.resource.space==XWiki.currentSpace&&(a=a.substring(a.indexOf(XWiki.constants.spacePageSeparator)+1,a.length)),this.input.value=a):b.clickCallback(a,b,c)},setValue:function(a){this.input.value=a},getValue:function(){return this.input.value},selectResource:function(a){this.setValue(XWiki.resource.serialize(a))},getSelectedResourceProperty:function(a){var b=this.getValue();return 0<b.length?XWiki.resource.get(b)[a]:null},isNewPage:function(){return null== this.getSelectedRecord()?!0:this.getSelectedRecord().isNewPage},isNewAttachment:function(){return this.getSelectedRecord().isNewAttachment}});